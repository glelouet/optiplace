tosca_definitions_version: tosca_simple_yaml_1_0_0_wd03

tosca_default_namespace: Tosca default namespace value
template_name: Template name value
template_author: Template author value
template_version: 1.0.0-SNAPSHOT

description: all inclusive (types + topology)

imports:
  - tosca-normative-types:  1.0.0.wd06-SNAPSHOT
  - hosanna-type: 1.0

topology_template:
  node_templates:
    ftpServer:
      type: hosanna.nodes.Compute
      capabilities:
            container:
              properties:
                disk_size: 10 GB
                num_cpus: 4
                mem_size: 4096 MB
      properties:
        stack:
          name: "FTP server"
          version: "2"
          installation:
            keyboard: "fr-latin9"
            firewall: false
            timezone: "Europe/Paris"
            internetSettings: "dhcp"            
            kernelParams:
              - "splash"
              - "quiet"
            rootUser:
              password: "root"
              setPassword: true            
            users:
              -
                name: "hosanna"
                fullName: "hosanna"
                homeDir: "/home/hosanna"
                shell: "/bin/bash"
                password: "test"
            diskSize: 8000
            swapSize: 512
            displayLicenses: false
          os:
            name: "Debian"
            version: "8"
            arch: "x86_64"
            profile: "minimal"
            pkgs:
              - name: "ncftp"
              - name: "vim"
              - name: "proftpd-basic"
          bundles:
            -
              name: "bull-proxy"
              version: "1.0"
              files:
                -
                  name: "proxy-bull.sh"
                  source: "bundles/proxy/proxy-bull.sh"
                  destination: "/etc/profile.d/"
          config:
            -
              name: "hostname_configure.sh"
              source: "config/hostname_configure_ftp_server.sh"
              type: "bootscript"
              frequency: "firstboot"
              order: "1"
        iaas:
	      ref-name: my-openstack-private
	      deployment-parameters:
	        zone: eu-west
	        disk-type: qcow2  

    dispatcher:
      type: hosanna.nodes.Compute
      capabilities:
            container:
              properties:
                disk_size: 10 GB
                num_cpus: 4
                mem_size: 4096 MB
      properties:
        stack:
          name: "Dispatcher"
          version: "1"
          installation:
            keyboard: "fr-latin9"
            firewall: false
            timezone: "Europe/Paris"
            internetSettings: "dhcp"           
            kernelParams:
              - "splash"
              - "quiet" 
            rootUser:
              password: "root"
              setPassword: true 
            users:
              -
                name: "hosanna"
                fullName: "hosanna"
                homeDir: "/home/hosanna"
                shell: "/bin/bash"
                password: "test"           
            diskSize: 8000
            swapSize: 512
            displayLicenses: false
          os:
            name: "Debian"
            version: "8"
            arch: "x86_64"
            profile: "minimal"       
            pkgs:
              - name: "ncftp"
              - name: "vim"
              - name: "proftpd-basic"    
              - name: "git"    
          bundles:
            -
              name: "dipatcher"
              version: "1.0"
              files:
                -
                  name: "dispatcher-full-0.2.1-SNAPSHOT.jar"
                  source: "bundles/dispatcher/dispatcher-full-0.2.1-SNAPSHOT.jar"
                  destination: "/opt/dispatcher"
                -
                  name: "accounts.txt"
                  source: "bundles/dispatcher/accounts.txt"
                  destination: "/opt/dispatcher"
          config:
            -
              name: "hostname_configure.sh"
              source: "config/hostname_configure_dispatcher.sh"
              type: "bootscript"
              frequency: "firstboot"
              order: "1"

        iaas:
	      ref-name: my-openstack-private
	      deployment-parameters:
	        zone: eu-west
	        disk-type: qcow2  


node_types:
  hosanna.nodes.Compute:
    derived_from: tosca.nodes.Compute
    description:
    capabilities:
      container:
        type: hosanna.capabilities.Container
    properties:
        stack:
          type: hosanna.datatypes.Stack

capability_types:
  hosanna.capabilities.Container:
    derived_from: tosca.capabilities.Root
    properties:
          disk_size:
            type: scalar-unit.size
            description: Size of the local disk available to applications running on the Compute node (default unit is MB).
            required: false
            constraints:
              - greater_or_equal: 0 MB
          num_cpus:
            type: integer
            description: Number of (actual or virtual) CPUs associated with the Compute node.
            required: false
            constraints:
              - greater_or_equal: 1
          mem_size:
            type: scalar-unit.size
            description: Size of memory available to applications running on the Compute node (default unit is MB).
            required: false
            constraints:
              - greater_or_equal: 0 MB


data_types:
  hosanna.datatypes.Stack:
    derived_from: tosca.datatypes.Root
    properties:
      name:
        required: true
        type: string
      version:
        required: true
        type: string
      os:
        required: true
        type: hosanna.datatypes.Stack.OS
      installation:
        required: false
        type: hosanna.datatypes.Stack.Installation
      bundles:
        required: false
        type: list
        entry_schema:
          type: hosanna.datatypes.Stack.Bundle
      config:
        required: false
        type: list
        entry_schema:
          type: hosanna.datatypes.Stack.Config

  hosanna.datatypes.Stack.OS:
    derived_from: tosca.datatypes.Root
    properties:
      name:
        required: true
        type: string
      version:
        required: true
        type: string
      arch:
        required: true
        type: string
      profile:
        required: false
        type: string
      pkgs:
        required: false
        type: list
        entry_schema:
          type: hosanna.datatypes.Stack.OS.Pkgs

  hosanna.datatypes.Stack.OS.Pkgs:
    derived_from: tosca.datatypes.Root
    properties:
      name:
        required: true
        type: string

  hosanna.datatypes.Stack.Installation:
    derived_from: tosca.datatypes.Root
    properties:
      keyboard:
        required: false
        type: string
      firewall:
        required: false
        type: boolean
      timezone:
        required: false
        type: string
      internetSettings:
        required: false
        type: string
      kernelParams:
        required: false
        type: list
        entry_schema:
          type: string
      rootUser:
        required: false
        type: hosanna.datatypes.Stack.Installation.RootUser
      users:
        required: false
        type: list
        entry_schema:
          type: hosanna.datatypes.Stack.Installation.User
      diskSize:
        required: false
        type: integer
      swapSize:
        required: false
        type: integer
      displayLicenses:
        required: false
        type: boolean


  hosanna.datatypes.Stack.Installation.RootUser:
    derived_from: tosca.datatypes.Root
    properties:
      password:
        required: true
        type: string
      setPassword:
        required: false
        type: boolean
      sshKeys:
        required: false
        type: list
        entry_schema:
          type: string

  hosanna.datatypes.Stack.Installation.User:
    derived_from: tosca.datatypes.Root
    properties:
      name:
        required: true
        type: string
      fullName:
        required: true
        type: string
      homeDir:
        required: true
        type: string
      shell:
        required: true
        type: string
      password:
        required: false
        type: string

  hosanna.datatypes.Stack.Bundle:
    derived_from: tosca.datatypes.Root
    properties:
      name:
        required: true
        type: string
      version:
        required: true
        type: string
      files:
        required: true
        type: list
        entry_schema:
          type: hosanna.datatypes.Stack.Bundle.Files


  hosanna.datatypes.Stack.Bundle.Files:
    derived_from: tosca.datatypes.Root
    properties:
      name:
        required: true
        type: string
      source:
        required: true
        type: string
      destination:
        required: true
        type: string

  hosanna.datatypes.Stack.Config:
    derived_from: tosca.datatypes.Root
    properties:
      name:
        required: true
        type: string
      source:
        required: true
        type: string
      type:
        required: true
        type: string
      frequency:
        required: true
        type: string
      order:
        required: true
        type: integer

